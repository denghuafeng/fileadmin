var global={DIR_ROOT:"",DIR_PATH:"dir",FILE_PATH:"file",FIEL_WEB_ROOT_URL:"http://127.0.0.1/ut/tmp/",DOC_WEB_ROOT_URL:"http://127.0.0.1/ut/servlet/ReadWordLocal",FA_LOGIN_URL:"login"};var DIR=DIR||{};var getExt=function(e){if(e&&e.length>0){var d;var f=e.lastIndexOf(".");if(f!=-1){d=e.substr(f+1)}else{d=""}}return d};var OFFICE_FILE_EXT=["doc","ppt","xls","docx","pptx","xlsx"];var isOfficeFile=function(b){return array.indexOf(OFFICE_FILE_EXT,b)};var getFolderIconCss=function(){return"folder"};var getFileIconCss=function(b){if(b=="folder"){return"folder"}switch(b){case"doc":ext="doc";break;case"docx":ext="doc";break;case"xls":ext="xls";break;case"xlsx":ext="xls";break;case"ppt":ext="ppt";break;case"pptx":ext="ppt";break;case"pdf":ext="pdf";break;case"txt":ext="txt";break;case"exe":ext="exe";break;case"html":ext="html";break;case"htm":ext="html";break;case"css":ext="css";break;case"js":ext="js";break;case"swf":ext="swf";break;case"fla":ext="swf";break;case"zip":ext="zip";break;case"rar":ext="rar";break;case"gz":ext="rar";break;case"tar":ext="rar";break;case"gif":ext="gif";break;case"png":ext="png";break;case"jpg":ext="jpg";break;case"mp3":ext="mp3";break;case"wma":ext="mp3";break;case"wav":ext="mp3";break;case"rm":ext="rm";break;default:ext="file"}return ext};function Directory(b){this.DIR=b?b:window.DIR;this.html=[];this.FileList=this.FileList?this.FileList:g("FileList");this.FileListContent=this.FileListContent?this.FileListContent:g("FileListContent");this.FileListTitle=this.FileListTitle?this.FileListTitle:g("FileListTitle");this.DirList=this.DirList?this.DirList:g("DirList");this.InfoPanel=this.InfoPanel?this.InfoPanel:g("InfoPanel")}Directory.prototype.setHTML=function(b){this.html=b};Directory.prototype.getHTML=function(){return this.html};Directory.prototype.listDirTree=function(){function b(d,a){DirAction.getDirJSON(d)}tree=new dhtmlXTreeObject("DirList","100%","100%",0);tree.setSkin("dhx_skyblue");tree.setImagePath("img/tree/");tree.enableDragAndDrop(0);tree.enableTreeLines(false);tree.setEscapingMode("utf8");tree.setImageArrays("plus",null,null,null,"plus_ar.gif");tree.setImageArrays("minus",null,null,null,"minus_ar.gif");tree.setStdImages("folderClosed.gif","folderOpen.gif","folderClosed.gif");tree.setXMLAutoLoading("dir!getTree.action");tree.setOnClickHandler(b);tree.loadXML("dir!getTree.action",function(){})};Directory.prototype.getDirListHTML=function(u){var i=u?u:this.DIR;var p=[];if(i){var r=i.Folders;var o=r.nameList.length;var q,s,t,d="";var n=new dTree("tree");n.add(0,-1,i.root);for(q=0;q<o;q++){d=i.absolutePath+r.nameList[q];t=r.nameList[q];p.push('<a href="#" onclick="DirAction.getDirJSON(\''+(d)+"');\">"+t+"</a>");n.add(q+1,0,t,"path?")}p.push(n)}this.setHTML(p);return p.join("")};Directory.prototype.getFileAndFolderTheadHTML=function(){return'<table class="file-table-head"><colgroup><col class="table-name"/><col class="table-size"/><col class="table-modified-date"/><col class="table-type"/><col class="table-blank"/></colgroup><tr><th>名称</th><th>大小</th><th>修改日期</th><th>类型</th><th>&nbsp;</th></tr></table>'};Directory.prototype.getFileAndFolderListHTML=function(y){var o=y?y:this.DIR;UploadActoin.uploadPath=y.path?y.path:y.absolutePath;var s=[];if(o){var p=o.FilesList;var n=0;var x=target=ext="",w="#",q="";function r(){return'<colgroup><col class="table-name"/><col class="table-size"/><col class="table-modified-date"/><col class="table-type"/><col class="table-blank"/></colgroup>'}function u(a){return""+getFileIconCss(a)}function t(a){var d=a?a:null;if(d==null){return""}x=d.name;ext=getExt(x);q=u(ext);var b="",c="&nbsp;";if(d.type=="folder"){w="#";if(global.FIEL_WEB_ROOT_URL){w=global.FIEL_WEB_ROOT_URL+o.relationPath+encodeURIComponent(x)}q=getFolderIconCss()}else{w="#";if(global.FIEL_WEB_ROOT_URL){w=global.FIEL_WEB_ROOT_URL+o.relationPath+encodeURIComponent(x)}if(isOfficeFile(ext)!=-1&&global.DOC_WEB_ROOT_URL){w=global.DOC_WEB_ROOT_URL+"?file="+o.absolutePath+encodeURIComponent(x)}target="_blank";c=ext}b=('<a href="'+w+'" class="'+q+'" target="'+target+'">'+x+"</a>");return"<tr><td>"+b+"</td><td>"+a.length+"</td><td>"+a.date+"</td><td>"+c+"</td><td>&nbsp;</td></tr>"}s.push('<table class="file-table-list" id="FileTableList">');s.push(r());for(var v in p){n++;v=p[v];s.push(t(v))}s.push("</table>")}this.setHTML(s);return s.join("")};Directory.prototype.getFileListHTML=function(q){var i=q?q:this.DIR;var m=[];if(i){var l=i.Files;var k=l.nameList.length;var o,p,n;for(n=0;n<k;n++){o=l.nameList[n];p=global.FILE_PATH+"?path="+encodeURIComponent(o);m.push('<a href="'+p+'">'+o+"</a><br/>")}}this.setHTML(m);return m.join("")};Directory.prototype.getInfoPanelHTML=function(m){var h=m?m:this.DIR;var j=[];if(h){var k=h.Folders.nameList.length;var l=h.Files.nameList.length;var i=k+l;j.push("<dl><dt>共:  "+i+" 个项目</dt>");j.push("<dd>文件夹: "+k+" 个");j.push(" , 文件: "+l+" 个</dd></dl>");j.push('<dl class="hard-size"><dt>硬盘大小:  '+h.hardPartition.totalSpace+" </dt>");j.push("<dd>已用空间: "+h.hardPartition.useableSpace+" ");j.push(" , 还剩: "+h.hardPartition.freeSpace+" </dd></dl>")}this.setHTML(j);return j.join("")};Directory.prototype.setDirAndFileList=function(c){if(hasError()){return false}var d=c?c:this.DIR;this.listDirTree();this.setFileAndFolderList(d)};Directory.prototype.setDirList=function(b){this.DirList.innerHTML=this.getDirListHTML(b)};Directory.prototype.setFileAndFolderList=function(b){if(hasError()){return false}this.FileListTitle.innerHTML=this.getFileAndFolderTheadHTML(b);this.FileListContent.innerHTML=this.getFileAndFolderListHTML(b)};Directory.prototype.setFileList=function(b){this.FileList.innerHTML=this.getFileListHTML(b)};Directory.prototype.setInfoPanel=function(b){this.InfoPanel.innerHTML=this.getInfoPanelHTML(b)};var UploadActoin=UploadActoin||{};var DirAction=DirAction||{};function hasError(){this.showTips=function(e){var f=[];for(var d in e){f.push(e[d]+"\r\n")}alert(f.join(""));e=null;delete e;gotoUrl()};this.gotoUrl=function(){window.location.replace(global.FA_LOGIN_URL)};if("undefined"!=typeof ErrorMessage){if(ErrorMessage!=null){showTips(ErrorMessage);return true}}return false}DirAction=function(){var dirClass=new Directory();var page=g("Page");var DIR=dirClass.DIR;var dirPath=global.DIR_PATH;var FileListContent=dirClass.FileListContent;var DirList=dirClass.DirList;var FileList=dirClass.FileList;var setPageHeight=function(){var h=document.body.offsetHeight;h=h>200?h:200;var height=h-180;dom.setStyle(FileListContent,"height",height);dom.setStyle(DirList,"height",height+41)};var pageInit=function(){dirClass.setDirAndFileList();dirClass.setInfoPanel();setPageHeight();event.on(window,"onresize",DirAction.setPageHeight)};var getDirJSON=function(path){var url=dirPath+"?path="+encodeURIComponent(path);xhr=ajax.get(url,parseDirJSON)};var parseDirJSON=function(xhr,responseText){eval(responseText);dirClass.setFileAndFolderList(DIR);dirClass.setInfoPanel(DIR)};return{pageInit:pageInit,setPageHeight:setPageHeight,getDirJSON:getDirJSON}}();UploadActoin=function(){var c="";var d=function(){var a;window.onload=function(){var b={flash_url:"swf/swfupload.swf",upload_url:"upload.action",file_post_name:"uploads",post_params:{path:"${file:getRelativePath(root, path)}"},file_size_limit:"1024 MB",file_types:"*.*",file_types_description:"All Files",file_upload_limit:100,file_queue_limit:0,custom_settings:{progressTarget:"fsUploadProgress",cancelButtonId:"btnCancel"},debug:false,button_image_url:"img/upload-button.png",button_width:"90",button_height:"24",button_placeholder_id:"spanButtonPlaceHolder",file_queued_handler:fileQueued,file_queue_error_handler:fileQueueError,file_dialog_complete_handler:fileDialogComplete,upload_start_handler:uploadStart,upload_progress_handler:uploadProgress,upload_error_handler:uploadError,upload_success_handler:uploadSuccess,upload_complete_handler:uploadComplete,queue_complete_handler:queueComplete};a=new SWFUpload(b)}};return{init:d,uploadPath:c}};DirAction.pageInit();